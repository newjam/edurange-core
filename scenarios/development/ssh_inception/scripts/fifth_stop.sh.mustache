#!/usr/bin/env bash

message=$(cat << "EOF"
 ___________    ___________                                                                  ______                
|            | |            `````|````` |         |                    ..'''' `````|`````  .~      ~.  |`````````, 
|______      | |______           |      |_________|                 .''            |      |          | |'''''''''  
|            | |                 |      |         |              ..'               |      |          | |           
|            | |                 |      |         |        ....''                  |       `.______.'  |           
                                                                                                                   

****************************************************************************************************
"The ecstasy that blooms in synapses is Paprika-brand milk fat! 5% is the norm.
The safety net of the ocean is nonlinear, even with what crabs dream of! Lets go!"

Decode the file 'betcha_cant_read_me' to find your way to the ultimate challenge... SATAN'S PALACE

****************************************************************************************************

EOF
)
{{#users}}
  cd /home/{{login}}

  echo "$message" > message
  chown {{login}}:{{login}} message
  chmod 400 message
  echo 'cat message' >> .bashrc

  echo -e "{{variables.fifth_stop_password}}\\n{{variables.fifth_stop_password}}" | passwd {{login}}

  echo "You found me. Good job. The next challenge will not be so easy. You will find Satans Palace on the host with a certain open port. The most evil open port. SSH to that port with the password '{{variables.satans_palace_password}}'. The final treasure awaits..." | base64 > betcha_cant_read_me

  chown {{login}}:{{login}} betcha_cant_read_me
  chmod 400 betcha_cant_read_me

  echo "{{variables.secret_fifth_stop}}" > flag
  chown {{login}}:{{login}} flag
  chmod 400 flag
{{/users}}
